<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.title | default: site.title }}</title>

    <!-- Minimal, self-contained styling -->
    <style>
      :root {
        --text-size: 16px;
        --line-height: 1.35;
        --content-width: 920px;
      }

      html { font-size: var(--text-size); }
      body {
        margin: 0;
        color: #111;
        background: #fff;
        line-height: var(--line-height);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      }

      header {
        border-bottom: 1px solid #eee;
        padding: 12px 16px;
      }

      header a { color: inherit; text-decoration: none; }
      header .title { font-weight: 600; }

      main {
        max-width: var(--content-width);
        margin: 0 auto;
        padding: 24px 16px 56px;
      }

      /* Basic markdown-ish styles */
      h1, h2, h3 { line-height: 1.2; }
      h1 { margin-top: 0; }
      pre {
        overflow: auto;
        padding: 12px 14px;
        border-radius: 6px;
        background: #f6f8fa;
      }
      code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
      img { max-width: 100%; }

      /* kramdown emits <script type="math/tex"> which will be replaced by KaTeX output */
      .katex-display { margin: 1em 0; }
    </style>

    <!-- KaTeX (CDN) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>

    <script>
      // Render kramdown math blocks (script[type^="math/tex"]) with KaTeX.
      document.addEventListener('DOMContentLoaded', () => {
        const scripts = document.querySelectorAll('script[type^="math/tex"]');
        for (const el of scripts) {
          const type = el.getAttribute('type') || '';
          const displayMode = type.includes('mode=display');
          const tex = el.textContent || '';

          const out = document.createElement(displayMode ? 'div' : 'span');
          if (displayMode) out.className = 'katex-display';

          try {
            if (window.katex && typeof window.katex.render === 'function') {
              window.katex.render(tex, out, { displayMode, throwOnError: false });
            } else {
              out.textContent = tex;
            }
          } catch (e) {
            out.textContent = tex;
          }

          el.replaceWith(out);
        }

        // Also render any remaining raw TeX delimiters in the page HTML.
        // This covers inline $...$ if kramdown doesn't convert it into math/tex scripts.
        if (typeof window.renderMathInElement === 'function') {
          window.renderMathInElement(document.querySelector('main') || document.body, {
            delimiters: [
              { left: '$$', right: '$$', display: true },
              { left: '$', right: '$', display: false },
              { left: '\\(', right: '\\)', display: false },
              { left: '\\[', right: '\\]', display: true }
            ],
            throwOnError: false,
            ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'option']
          });
        }
      });
    </script>
  </head>

  <body>
    <header>
      <a class="title" href="{{ '/' | relative_url }}">{{ site.title }}</a>
      {% if page.title %}
        <span> / {{ page.title }}</span>
      {% endif %}
    </header>

    <main>
      {{ content }}
    </main>
  </body>
</html>
